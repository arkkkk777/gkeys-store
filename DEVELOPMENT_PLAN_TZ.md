# GKEYS Store - Полный план доработки согласно ТЗ

## Обзор проекта

Доработка GKEYS Store (React + TypeScript) согласно техническому заданию с интеграцией:
- PostgreSQL базы данных
- Backend API (Node.js + Express)
- Админ-панель для управления контентом
- Платежная система (мульти-гейтвей: Stripe, PayPal, Mollie, кастомные)
- G2A API интеграция (синхронизация каталога, покупка ключей, 2% markup)
- Два типа интеграции платежного гейта (пополнение баланса + терминальные транзакции)
- Функционал из проекта-донора (gkeys Vue)
- Структура платежей из onlineKassa

## Специфические требования из ТЗ

### Главная страница

1. **Hero Block с каруселью иконок**
   - Карусель с иконками игр в верхней части
   - Автоматическое переключение (auto-play)
   - При выборе иконки меняется: картинка на бэкграунде, описание, цена
   - Кнопки: Buy (в корзину), Heart (в Wishlist), More info (страница игры)

2. **Best Seller**
   - Рандомные игры из доступного списка
   - Обновление раз в неделю (Redis кэш)
   - Плашка "Best Seller" на каждой игре
   - Кнопки категорий по жанрам (фильтрация)
   - 8 случайных игр по выбранному жанру
   - Кнопка "Check all" → каталог

3. **New in the Catalog**
   - Карусель из 15 карточек игр
   - Случайный выбор из доступного списка
   - Обновление 1 раз в день (Redis кэш)
   - Кнопка "Check All" → каталог

4. **Preorders**
   - Карусель игр с тегом "Pre-order"
   - Кнопка "Check All" → каталог

5. **New Games**
   - Карусель из 10 игр
   - Дата выхода до 2-х недель от текущей
   - Кнопка "Check All" → каталог

6. **Игры по жанрам**
   - Карусели по 20 карточек игр
   - Объединены одним жанровым тегом
   - Кнопка "Check all" → каталог с активированным жанровым фильтром

7. **Рандомные игры**
   - Карусель из 10 карточек
   - Случайный выбор при каждом обновлении страницы

### Каталог

1. **Пагинация**: 36 игр на странице, 3 в строке
2. **Счетчик доступных игр**
3. **Фильтры**:
   - Поиск по сумме игры (range slider)
   - Пресет по суммам (under-10, 10-25, 25-50, 50-100, over-100)
   - In Stock Only (по умолчанию включен, скрывает Preorder)
   - Мультиселект Platform
   - Мультиселект Activation Service
   - Мультиселект Activation Region
   - Мультиселект Multiplayer
   - Мультиселект Publisher
   - Мультиселект Genre
4. **Отображение выбранных фильтров** (с возможностью удаления)
5. **Поиск** по названию
6. **Быстрая сортировка**: Популярные, сначала новые, сначала дорогие, сначала дешевые
7. **Подборки**: карусель из 10 заранее сделанных подборок по жанрам/издателям
8. **Карточка игры**:
   - Плашки: Best Seller (случайно), New (до 2 недель), Preorder (тег)
   - Случайная скидка 5-10% (кроме New игр)
   - Оригинальная цена перечеркнута, новая цена рядом

### Страница игры

1. **Hero Block**: картинка на бэкграунде, название, краткое описание, способ доставки (Key), платформа, ссылка на гайд активации, цена, кнопки Buy и Wishlist
2. **Дополнительная информация**: описание игры и теги
3. **Похожие игры**: карусель из 10 игр с минимум 2 общими тегами

### Checkout

1. Счетчик товаров в корзине
2. Перечень товаров: количество, название, платформа, цена (со скидкой), кнопки Wishlist и удалить
3. Окно чекаута:
   - Общая стоимость
   - Общая сумма скидки
   - Окно промокода (UI только)
   - Total
   - Баланс клиента
   - Кнопка пополнения баланса
   - Кнопка оплатить
   - Если недостаточно средств → редирект на страницу баланса
   - При успехе → редирект на страницу заказов (статус Completed)
   - Отправка email с ключами
4. Подборка предложений: игры со схожими тегами, кнопка "Добавить в корзину"

### Профиль клиента

1. Ник клиента (по умолчанию "Newbie Guy")
2. Счетчик купленных игр
3. Сколько сэкономлено на скидках
4. Сколько дней после регистрации

### Страница заказов

1. Перечень купленных игр
2. Номер заказа
3. Дата заказа
4. Стоимость игры
5. Клик на иконку игры → страница игры

### Wishlist

1. Все игры из Wishlist
2. Если есть игры → клик открывает страницу игры
3. Если нет игр → кнопка в каталог
4. Внизу: 8 случайных карточек игр (разные при каждом обновлении)

### Страница баланса

1. Текущий баланс
2. Окно промокода
3. Окно ввода суммы пополнения
4. Выбор способа оплаты
5. Кнопка "Proceed to pay" → редирект на платежную страницу гейта

### Редактирование профиля

1. Изменение ника (по умолчанию "Newbie Guy")
2. Имя
3. Фамилия
4. Смена пароля
5. Email изменить нельзя
6. Счетчик незаполненных полей около кнопки "Edit Profile"

### Страница блога

1. Фильтры поиска по типу статьи
2. Лента статей
3. Карточка статьи: тег, название, вступление, картинка, кнопка "Read Article"

### Статья

1. Тег
2. Заголовок
3. Вступление
4. Картинка
5. Основной текст
6. Кнопка возврата в ленту

### FAQ

1. Вопросы и ответы по категориям

### Privacy и Terms & Conditions

1. Простые страницы с текстом

## Email письма (4 типа)

1. **Регистрация** - после успешной регистрации
2. **Пополнение баланса** - после успешной транзакции от гейта
3. **Код игры** - после покупки, когда получен ключ по API
4. **Сброс пароля** - при нажатии "Forgot Password"

## Интеграции платежного гейта

### 1. Прямая интеграция для пополнения баланса

- Подключение к странице Balance
- Клиент указывает сумму и способ оплаты
- Редирект на платежную страницу гейта
- После успешной оплаты (статус Completed):
  - Пополнение баланса
  - Отправка email о пополнении
- Валюта: указывается в EUR, но конвертируется в валюту гейта (например, PLN)

### 2. Интеграция на получение информации по транзакциям не с сайта

- Парсинг транзакций с терминала
- Создание клиентов из транзакций:
  - Извлечение: email, имя, фамилия
  - Создание пользователя (без пароля, не может войти)
  - Никнейм: "Newbie Guy"
- Создание истории Top-up balance
- Генерация fake покупок:
  - 85-100% от баланса
  - Рандомные игры
  - Создание ордеров со статусом Completed
  - Списание баланса
- Вся информация только в админке
- **НИКАКИЕ ПИСЬМА НЕ ОТПРАВЛЯЮТСЯ**

## G2A интеграция

### 1. Управление ассортиментом

- Запрос списка товаров через API
- Получение: цены, картинки, описание
- Автоматическая генерация карточек
- Обновление 2 раза в день
- Обновление ассортимента (новые, обновленные, удаленные)

### 2. Автоматизированная покупка

- При покупке на сайте → запрос ключа в G2A
- Покупка с баланса G2A аккаунта
- **Важно**: цены на сайте на 2% выше, чем в G2A

## Требования к бэкэнду

1. Поиск клиента по имени и email
2. Фильтрация топ-апов по методу оплаты, дате и времени
3. Поиск по хэшу транзакции
4. Страница клиента: все топ-апы и купленные ключи
5. Выгрузка саммари по клиенту: все топ-апы и ордера в 1 PDF файле

## Технический стек

### Frontend
- React 19 + TypeScript
- Vite
- React Router
- Tailwind CSS + shadcn/ui
- Framer Motion
- Context API (Auth, Cart, Games, Orders, Blog)

### Backend
- Node.js + Express
- TypeScript
- Prisma ORM
- PostgreSQL
- JWT Authentication
- Express Validator
- Nodemailer (email)
- Bull/BullMQ (очереди)
- node-cron (scheduled jobs)

### Инфраструктура
- PostgreSQL Database
- Redis (кэширование, сессии, очереди)
- File Storage (S3 или локальное)
- Email Service (SendGrid/Mailgun)

## MCP Серверы

1. **@filesystem** - Работа с файлами проекта
2. **@github** - Версионирование
3. **@memory** - Сохранение контекста
4. **@code-sandbox** - Тестирование

## Этапы разработки

### Этап 1: Backend Foundation
- Настройка проекта
- Prisma schema
- Миграции и seed
- Базовые API endpoints

### Этап 2: Core Features
- Games API с фильтрами и пагинацией
- Orders API с обработкой ключей
- Payment API (базовая)
- Email service

### Этап 3: Frontend - Главная страница
- Hero Block с каруселью иконок
- Best Seller (с кэшированием)
- New in Catalog (с кэшированием)
- Preorders, New Games, жанровые карусели
- Рандомные игры

### Этап 4: Frontend - Каталог
- Пагинация (36 игр, 3 в строке)
- Все фильтры согласно ТЗ
- Отображение активных фильтров
- Сортировка
- Подборки
- Карточки с плашками и скидками

### Этап 5: Frontend - Страница игры
- Hero Block
- Дополнительная информация
- Похожие игры

### Этап 6: Frontend - Checkout
- Список товаров
- Окно чекаута
- Проверка баланса
- Рекомендуемые игры

### Этап 7: Frontend - Профиль
- Статистика (игры, скидки, дни)
- Заказы
- Баланс
- Редактирование профиля
- Wishlist

### Этап 8: Frontend - Блог и Support
- Страница блога
- Страница статьи
- FAQ
- Privacy и Terms

### Этап 9: Payment Integration
- Компоненты из onlineKassa
- Мульти-гейтвей поддержка
- Webhook обработка
- Интеграция пополнения баланса
- Интеграция терминальных транзакций

### Этап 10: G2A Integration
- Синхронизация каталога (2 раза в день)
- Покупка ключей
- Проверка наличия
- 2% markup на цены

### Этап 11: Admin Panel
- Dashboard
- Game Management
- Blog Management
- User Management (поиск, фильтры, PDF экспорт)
- Transaction Monitoring
- Payment Forms/Methods Editor
- G2A Sync

### Этап 12: Оптимизация
- Redis кэширование
- Оптимизация запросов
- Индексы БД
- Тестирование

